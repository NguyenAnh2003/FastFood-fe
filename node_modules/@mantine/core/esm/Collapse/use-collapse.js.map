{"version":3,"file":"use-collapse.js","sources":["../../src/Collapse/use-collapse.ts"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { flushSync } from 'react-dom';\nimport { useDidUpdate, mergeRefs } from '@mantine/hooks';\n\nfunction getAutoHeightDuration(height: number | string) {\n  if (!height || typeof height === 'string') {\n    return 0;\n  }\n  const constant = height / 36;\n  return Math.round((4 + 15 * constant ** 0.25 + constant / 5) * 10);\n}\n\nexport function getElementHeight(\n  el: React.RefObject<HTMLElement> | { current?: { scrollHeight: number } }\n) {\n  return el?.current ? el.current.scrollHeight : 'auto';\n}\n\nexport function getElementWidth(\n  el: React.RefObject<HTMLElement> | { current?: { scrollWidth: number } }\n) {\n  return el?.current ? el.current.scrollWidth : 'auto';\n}\n\nconst raf = typeof window !== 'undefined' && window.requestAnimationFrame;\n\ninterface UseCollapse {\n  axis: 'x' | 'y';\n  opened: boolean;\n  transitionDuration?: number;\n  transitionTimingFunction?: string;\n  onTransitionEnd?: () => void;\n}\n\ninterface GetCollapseProps {\n  [key: string]: unknown;\n  style?: React.CSSProperties;\n  onTransitionEnd?: (e: TransitionEvent) => void;\n  refKey?: string;\n  ref?: React.MutableRefObject<HTMLDivElement> | ((node: HTMLDivElement) => void);\n}\n\nexport function useCollapse({\n  transitionDuration,\n  transitionTimingFunction = 'ease',\n  onTransitionEnd = () => {},\n  opened,\n  axis,\n}: UseCollapse): (props: GetCollapseProps) => Record<string, any> {\n  const el = useRef<HTMLElement | null>(null);\n  const collapsedHeight = '0px';\n  const [styles, setStylesRaw] = useState<React.CSSProperties>({});\n\n  const setStyles = (newStyles: {} | ((oldStyles: {}) => {})): void => {\n    flushSync(() => setStylesRaw(newStyles));\n  };\n\n  const mergeStyles = (newStyles: {}): void => {\n    setStyles((oldStyles) => ({ ...oldStyles, ...newStyles }));\n  };\n\n  function getTransitionStyles(height: number | string): {\n    transition?: string;\n    transitionProperty?: string;\n    transitionDuration?: string;\n    transitionTimingFunction?: string;\n  } {\n    const _duration = transitionDuration || getAutoHeightDuration(height);\n    return {\n      transitionProperty: `${axis === 'x' ? 'width' : 'height'}`,\n      transitionDuration: `${_duration}ms`,\n      transitionTimingFunction: `${transitionTimingFunction}`,\n    };\n  }\n\n  const getDefaultSizes = () => {\n    const oldStyles = styles;\n    setStyles({});\n    const sizes = { width: getElementWidth(el), height: getElementHeight(el) };\n    setStyles(oldStyles);\n    return sizes;\n  };\n\n  const getCollapsedStyles = () => {\n    const { height } = getDefaultSizes();\n    return {\n      x: { height, width: '0px', overflow: 'hidden' },\n      y: { display: 'none', height: '0px', overflow: 'hidden' },\n    };\n  };\n\n  useEffect(() => {\n    raf(() => {\n      const { x, y } = getCollapsedStyles();\n      if (axis === 'x' && !opened) {\n        setStyles({ ...x });\n      } else if (axis === 'y' && !opened) {\n        setStyles({ ...y });\n      }\n    });\n  }, []);\n\n  // y axis\n  useDidUpdate(() => {\n    if (axis === 'x') return;\n\n    if (opened) {\n      raf(() => {\n        mergeStyles({ willChange: 'height', display: 'block', overflow: 'hidden' });\n        raf(() => {\n          const height = getElementHeight(el);\n          mergeStyles({ ...getTransitionStyles(height), height });\n        });\n      });\n    } else {\n      raf(() => {\n        const height = getElementHeight(el);\n        mergeStyles({ ...getTransitionStyles(height), willChange: 'height', height });\n        raf(() => mergeStyles({ height: collapsedHeight, overflow: 'hidden' }));\n      });\n    }\n  }, [opened]);\n\n  // x axis\n  useDidUpdate(() => {\n    if (axis === 'y') return;\n\n    if (opened) {\n      raf(() => {\n        const { width } = getDefaultSizes();\n        mergeStyles({\n          display: 'block',\n          overflow: 'hidden',\n          willChange: 'width',\n          flexShrink: 0,\n        });\n        raf(() => {\n          mergeStyles({ ...getTransitionStyles(width), width });\n        });\n      });\n    } else {\n      raf(() => {\n        const { width, height } = getDefaultSizes();\n        mergeStyles({\n          ...getTransitionStyles(width),\n          flexShrink: 0,\n          willChange: 'width',\n          width,\n          height,\n        });\n        raf(() => mergeStyles({ width: '0px', overflow: 'hidden' }));\n      });\n    }\n  }, [opened]);\n\n  const handleTransitionEnd = (e: React.TransitionEvent): void => {\n    if (e.target !== el.current || !(e.propertyName === 'width' || 'height')) {\n      return;\n    }\n\n    onTransitionEnd();\n    if (opened) {\n      setStyles({});\n    } else {\n      const { x, y } = getCollapsedStyles();\n      if (axis === 'x') setStyles(x);\n      else setStyles(y);\n    }\n  };\n\n  function getCollapseProps({ style = {}, refKey = 'ref', ...rest }: GetCollapseProps = {}) {\n    const theirRef: any = rest[refKey];\n\n    return {\n      'aria-hidden': !opened,\n      ...rest,\n      [refKey]: mergeRefs(el, theirRef),\n      onTransitionEnd: handleTransitionEnd,\n      style: { boxSizing: 'border-box', ...style, ...styles },\n    };\n  }\n\n  return getCollapseProps;\n}\n"],"names":[],"mappings":"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"}